# 媒体播放器扩展（原图片播放器升级）

## 功能（新增标注）

- 本地全媒体播放：支持图片（PNG/JPG/GIF/APNG/WebP）+ 视频（WebM/MP4/OGV/MKV/AVI）
- 播放控制增强：
  - 视频专属：进度条拖拽、音量调节、循环播放、自定义控制栏
  - 媒体筛选：一键切换“所有媒体/仅图片/仅视频”
- 原有核心功能保留：
  - 随机/顺序播放模式
  - AI 回复/玩家消息检测自动切换
  - 窗口锁定/拖拽/Resize
  - 多种图片过渡效果（淡入淡出/滑动/缩放）

## 安装（不变，补充视频注意事项）

1. 本地安装：将扩展文件夹放入 SillyTavern 的 `public\scripts\extensions\third-party` 目录
2. 安装 Python 依赖：`pip install -r requirements.txt`（建议用虚拟环境）
3. 启动媒体服务：`python image_service.py`
   - 首次启动默认扫描 `F:\Download`，可在扩展设置中修改目录
   - 视频文件默认最大 100MB，图片 5MB，可在设置中调整大小限制

## 新增功能使用说明

### 1. 视频播放

- 加载视频后自动显示进度条、音量条、循环按钮
- 进度条支持拖拽定位，音量条支持精细调节（0-100%）
- 循环按钮激活后，视频会重复播放（不触发自动切换）
- 浏览器限制：部分浏览器（如 Chrome）需手动点击视频才能播放（自动播放政策限制）

### 2. 媒体筛选

- 播放器控制栏右侧新增筛选按钮：
  - 🎞️ 所有媒体：显示图片+视频
  - 🖼️ 仅图片：隐藏所有视频文件
  - 🎥 仅视频：隐藏所有图片文件

### 3. 视频优化设置

- 在扩展设置中可配置：
  - 视频预加载：默认关闭（节省流量，大视频建议保持关闭）
  - 视频默认音量：初始 80%，可自定义
  - 视频控制栏显示/隐藏：按需切换（隐藏后用浏览器默认控制）

## 配置（新增视频相关项）

1. 基础配置：
   - 媒体目录：选择本地存放图片/视频的文件夹
   - 播放模式：随机（打乱播放）/顺序（按修改时间排序）
   - 切换条件：定时（自定义间隔）/AI 检测（AI 回复/玩家发送时切换）
2. 视频专属配置：
   - 视频大小限制：默认 100MB（可增大，需注意加载速度）
   - 视频循环：默认关闭（开启后视频重复播放）
   - 预加载视频：默认关闭（开启后提前加载下一个视频的元数据）

## 注意事项

1. 视频格式兼容性：
   - 推荐 WebM（体积小、兼容性好）和 MP4（通用格式）
   - MKV/AVI 等格式需确保浏览器支持（部分旧浏览器可能无法播放）
2. 性能建议：
   - 避免同时加载多个大视频（建议单视频不超过 200MB）
   - 低配置设备建议关闭“视频预加载”和“实时 WebSocket 连接”
3. 故障排查：
   - 视频加载失败：检查文件路径是否含中文/特殊字符，或文件是否损坏
   - 自动播放失败：手动点击视频播放（浏览器政策限制）
   - 服务连接失败：确保 `image_service.py` 已启动，且服务地址为 `http://localhost:9000`

## 作者

DeepSeek和豆包和反死

## 版本更新

- v1.4.0：升级为媒体播放器，新增视频播放、媒体筛选、视频控制功能
- v1.3.0：基础图片播放器功能
